<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Generator Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }
        .section-title {
            margin-top: 0;
            color: #3498db;
            font-weight: 600;
        }
        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
        }
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
        }
        button:hover {
            background-color: #2980b9;
        }
        .titles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .title-btn {
            background-color: #f1f1f1;
            color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        .title-btn:hover {
            background-color: #3498db;
            color: white;
        }
        .anchor-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .anchor-pair {
            display: flex;
            gap: 10px;
            align-items: center;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
        }
        .output-section {
            position: relative;
        }
        .action-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        #htmlPreview {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            margin-top: 20px;
            background-color: white;
        }
        .hidden {
            display: none;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .checkbox-container input {
            margin-right: 10px;
        }
        .github-section {
            background-color: #f5f5f5;
            border-color: #e1e4e8;
        }
        .github-btn {
            background-color: #24292e;
        }
        .github-btn:hover {
            background-color: #1a1f24;
        }
        .github-connected {
            color: #28a745;
            font-weight: 600;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Content Generator Tool</h1>
        
        <!-- GitHub Connection Section -->
        <div class="section github-section">
            <h2 class="section-title">Connect to GitHub</h2>
            <div id="githubAuthSection">
                <p>Connect your GitHub account to save articles directly to your repositories.</p>
                <button id="connectGithubBtn" class="github-btn">Connect GitHub Account</button>
            </div>
            <div id="githubConnectedSection" class="hidden">
                <p>Connected to GitHub as <span id="githubUsername"></span> <span class="github-connected">âœ“</span></p>
                <div class="checkbox-container">
                    <input type="checkbox" id="autoCommit" checked>
                    <label for="autoCommit">Auto-commit changes</label>
                </div>
                <div id="repoSettings" class="hidden">
                    <input type="text" id="repoName" placeholder="Repository name">
                    <input type="text" id="filePath" placeholder="File path (e.g., articles/my-article.html)">
                    <input type="text" id="commitMessage" placeholder="Commit message">
                </div>
                <button id="saveToGithubBtn" class="github-btn hidden">Save to GitHub</button>
                <button id="disconnectGithubBtn">Disconnect</button>
            </div>
        </div>
        
        <!-- URL Input Section -->
        <div class="section">
            <h2 class="section-title">Step 1: Enter Website URL</h2>
            <input type="text" id="websiteUrl" placeholder="Paste website URL here...">
            <button id="generateTitlesBtn">Generate Informational Article Titles</button>
            
            <div id="titlesResult" class="hidden">
                <h3>Generated Titles:</h3>
                <div class="titles-container" id="titlesContainer"></div>
            </div>
        </div>
        
        <!-- Article Generation Section -->
        <div class="section">
            <h2 class="section-title">Step 2: Generate Article</h2>
            <input type="text" id="articleTitle" placeholder="Paste or select a title from above">
            <div class="checkbox-container">
                <input type="checkbox" id="generateHeadings" checked>
                <label for="generateHeadings">Generate headings based on title</label>
            </div>
            <button id="generateArticleBtn">Generate Detailed Article</button>
        </div>
        
        <!-- Single Anchor Text Control -->
        <div class="section hidden" id="anchorControls">
            <h2 class="section-title">Step 3: Add Anchor Link</h2>
            <div class="anchor-pair">
                <input type="text" placeholder="Anchor Text" id="anchorText">
                <input type="text" placeholder="Target URL" id="targetUrl">
                <select id="anchorPosition">
                    <option value="first">First Paragraph</option>
                    <option value="second">Second Paragraph</option>
                    <option value="third">Third Paragraph</option>
                    <option value="last">Last Paragraph</option>
                </select>
            </div>
            <button id="addAnchorToArticleBtn">Add to Article</button>
        </div>
        
        <!-- Article Output Section -->
        <div class="section output-section hidden" id="articleOutputSection">
            <h2 class="section-title">Generated Article</h2>
            <div class="action-buttons">
                <button id="copyContentBtn">Copy Content</button>
                <button id="downloadHtmlBtn">Download index.html</button>
                <button id="saveToGithubBtn2" class="github-btn hidden">Save to GitHub</button>
            </div>
            <iframe id="htmlPreview"></iframe>
        </div>
    </div>

    <script>
        // DOM Elements
        const websiteUrlInput = document.getElementById('websiteUrl');
        const generateTitlesBtn = document.getElementById('generateTitlesBtn');
        const titlesResult = document.getElementById('titlesResult');
        const titlesContainer = document.getElementById('titlesContainer');
        const articleTitleInput = document.getElementById('articleTitle');
        const generateHeadingsCheckbox = document.getElementById('generateHeadings');
        const generateArticleBtn = document.getElementById('generateArticleBtn');
        const anchorControls = document.getElementById('anchorControls');
        const anchorTextInput = document.getElementById('anchorText');
        const targetUrlInput = document.getElementById('targetUrl');
        const anchorPositionSelect = document.getElementById('anchorPosition');
        const addAnchorToArticleBtn = document.getElementById('addAnchorToArticleBtn');
        const articleOutputSection = document.getElementById('articleOutputSection');
        const copyContentBtn = document.getElementById('copyContentBtn');
        const downloadHtmlBtn = document.getElementById('downloadHtmlBtn');
        const htmlPreview = document.getElementById('htmlPreview');
        
        // GitHub Elements
        const connectGithubBtn = document.getElementById('connectGithubBtn');
        const disconnectGithubBtn = document.getElementById('disconnectGithubBtn');
        const githubAuthSection = document.getElementById('githubAuthSection');
        const githubConnectedSection = document.getElementById('githubConnectedSection');
        const githubUsername = document.getElementById('githubUsername');
        const autoCommitCheckbox = document.getElementById('autoCommit');
        const repoSettings = document.getElementById('repoSettings');
        const repoNameInput = document.getElementById('repoName');
        const filePathInput = document.getElementById('filePath');
        const commitMessageInput = document.getElementById('commitMessage');
        const saveToGithubBtn = document.getElementById('saveToGithubBtn');
        const saveToGithubBtn2 = document.getElementById('saveToGithubBtn2');
        
        // GitHub State
        let githubAccessToken = null;
        let githubUser = null;
        
        // Event Listeners
        generateTitlesBtn.addEventListener('click', generateTitles);
        generateArticleBtn.addEventListener('click', generateArticle);
        addAnchorToArticleBtn.addEventListener('click', addAnchorToArticle);
        copyContentBtn.addEventListener('click', copyContent);
        downloadHtmlBtn.addEventListener('click', downloadHtml);
        connectGithubBtn.addEventListener('click', connectGithub);
        disconnectGithubBtn.addEventListener('click', disconnectGithub);
        autoCommitCheckbox.addEventListener('change', toggleRepoSettings);
        saveToGithubBtn.addEventListener('click', saveToGithub);
        saveToGithubBtn2.addEventListener('click', saveToGithub);
        
        // Check for existing GitHub connection on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedToken = localStorage.getItem('githubAccessToken');
            const savedUser = localStorage.getItem('githubUser');
            
            if (savedToken && savedUser) {
                githubAccessToken = savedToken;
                githubUser = JSON.parse(savedUser);
                updateGithubUI();
            }
        });
        
        // GitHub Functions
        function connectGithub() {
            // Redirect to GitHub OAuth
            const clientId = 'YOUR_GITHUB_CLIENT_ID'; // Replace with your actual GitHub OAuth App Client ID
            const redirectUri = encodeURIComponent(window.location.origin + window.location.pathname);
            const scope = 'repo,user';
            const githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}`;
            
            // Open in new window for better UX
            const width = 600, height = 600;
            const left = (window.innerWidth - width) / 2;
            const top = (window.innerHeight - height) / 2;
            
            const authWindow = window.open(
                githubAuthUrl,
                'githubAuth',
                `toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${width}, height=${height}, top=${top}, left=${left}`
            );
            
            // Listen for message from the popup
            window.addEventListener('message', function handleMessage(event) {
                if (event.origin !== window.location.origin) return;
                
                if (event.data.type === 'github-auth-success') {
                    githubAccessToken = event.data.token;
                    githubUser = event.data.user;
                    
                    localStorage.setItem('githubAccessToken', githubAccessToken);
                    localStorage.setItem('githubUser', JSON.stringify(githubUser));
                    
                    updateGithubUI();
                    authWindow.close();
                    window.removeEventListener('message', handleMessage);
                }
            });
        }
        
        function disconnectGithub() {
            githubAccessToken = null;
            githubUser = null;
            localStorage.removeItem('githubAccessToken');
            localStorage.removeItem('githubUser');
            
            githubAuthSection.classList.remove('hidden');
            githubConnectedSection.classList.add('hidden');
            saveToGithubBtn.classList.add('hidden');
            saveToGithubBtn2.classList.add('hidden');
        }
        
        function updateGithubUI() {
            githubAuthSection.classList.add('hidden');
            githubConnectedSection.classList.remove('hidden');
            githubUsername.textContent = githubUser.login;
            
            // Show save button if we have content
            if (htmlPreview.srcdoc) {
                saveToGithubBtn.classList.remove('hidden');
                saveToGithubBtn2.classList.remove('hidden');
            }
        }
        
        function toggleRepoSettings() {
            if (autoCommitCheckbox.checked) {
                repoSettings.classList.remove('hidden');
            } else {
                repoSettings.classList.add('hidden');
            }
        }
        
        async function saveToGithub() {
            if (!githubAccessToken) {
                alert('Please connect your GitHub account first');
                return;
            }
            
            const content = htmlPreview.srcdoc;
            if (!content) {
                alert('No content to save');
                return;
            }
            
            const repo = repoNameInput.value.trim() || 'content-generator-articles';
            const path = filePathInput.value.trim() || `articles/article-${Date.now()}.html`;
            const message = commitMessageInput.value.trim() || 'Add new generated article';
            
            try {
                saveToGithubBtn.disabled = true;
                saveToGithubBtn.innerHTML = '<span class="loading"></span> Saving...';
                saveToGithubBtn2.disabled = true;
                saveToGithubBtn2.innerHTML = '<span class="loading"></span> Saving...';
                
                // Check if repo exists, create if not
                let repoExists = true;
                try {
                    await fetch(`https://api.github.com/repos/${githubUser.login}/${repo}`, {
                        headers: {
                            'Authorization': `token ${githubAccessToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                } catch (error) {
                    repoExists = false;
                }
                
                if (!repoExists) {
                    // Create new repository
                    const createResponse = await fetch('https://api.github.com/user/repos', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${githubAccessToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: repo,
                            description: 'Articles generated with Content Generator Tool',
                            private: false,
                            auto_init: true
                        })
                    });
                    
                    if (!createResponse.ok) {
                        throw new Error('Failed to create repository');
                    }
                }
                
                // Create or update file
                const putResponse = await fetch(`https://api.github.com/repos/${githubUser.login}/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubAccessToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        content: btoa(unescape(encodeURIComponent(content))),
                        branch: 'main'
                    })
                });
                
                if (!putResponse.ok) {
                    throw new Error('Failed to save file to GitHub');
                }
                
                alert('Successfully saved to GitHub!');
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                alert('Failed to save to GitHub: ' + error.message);
            } finally {
                saveToGithubBtn.disabled = false;
                saveToGithubBtn.innerHTML = 'Save to GitHub';
                saveToGithubBtn2.disabled = false;
                saveToGithubBtn2.innerHTML = 'Save to GitHub';
            }
        }
        
        // API Integration Points (to be implemented in your backend)
        async function callGenerateTitles(url) {
            // Replace with your actual API call
            console.log("Calling title generation API for URL:", url);
            
            // Mock response - replace with actual API call
            return new Promise(resolve => {
                setTimeout(() => {
                    const mockTitles = [
                        "10 Essential Tips for Improving Your Website's SEO Performance",
                        "The Complete Guide to Creating Engaging Content for Your Audience",
                        "How to Optimize Your Website for Faster Loading Speeds",
                        "Understanding the Latest Google Algorithm Updates and Their Impact",
                        "Mobile-First Design: Why It's Crucial for Your Online Success",
                        "The Psychology Behind Effective Call-to-Action Buttons",
                        "Building Trust Online: Strategies for Authentic Brand Representation",
                        "Content Marketing Strategies That Actually Drive Conversions"
                    ];
                    resolve(mockTitles);
                }, 1000);
            });
        }
        
        async function callGenerateArticle(title, generateHeadings) {
            // Replace with your actual API call
            console.log("Calling article generation API for title:", title, "with headings:", generateHeadings);
            
            // Mock response - replace with actual API call
            return new Promise(resolve => {
                setTimeout(() => {
                    let article = `# ${title}\n\n`;
                    
                    if (generateHeadings) {
                        article += `## Introduction\n\nThis is a generated article about ${title}. The introduction paragraph would normally contain engaging content about the topic.\n\n`;
                        
                        // Generate 3-5 sections with headings based on title
                        const sections = [
                            "Key Benefits and Features",
                            "Implementation Strategies",
                            "Common Challenges and Solutions",
                            "Expert Recommendations",
                            "Future Trends"
                        ].slice(0, 3 + Math.floor(Math.random() * 3));
                        
                        sections.forEach(section => {
                            article += `## ${section}\n\nSeveral paragraphs would appear here with detailed information about ${title} related to ${section.toLowerCase()}.\n\n`;
                        });
                        
                        article += `## Conclusion\n\nA summary of the key points about ${title} would appear here.`;
                    } else {
                        article += `This is a generated article about ${title}. The content would normally contain several paragraphs with detailed information about the topic, without specific section headings.`;
                    }
                    
                    resolve(article);
                }, 1500);
            });
        }
        
        // UI Functions
        async function generateTitles() {
            if (!websiteUrlInput.value.trim()) {
                alert('Please enter a website URL first');
                return;
            }
            
            generateTitlesBtn.disabled = true;
            generateTitlesBtn.innerHTML = '<span class="loading"></span> Generating...';
            
            try {
                const titles = await callGenerateTitles(websiteUrlInput.value.trim());
                
                titlesContainer.innerHTML = '';
                titles.forEach(title => {
                    const titleBtn = document.createElement('div');
                    titleBtn.className = 'title-btn';
                    titleBtn.textContent = title;
                    titleBtn.addEventListener('click', () => {
                        articleTitleInput.value = title;
                    });
                    titlesContainer.appendChild(titleBtn);
                });
                
                titlesResult.classList.remove('hidden');
            } catch (error) {
                console.error('Error generating titles:', error);
                alert('Failed to generate titles. Please try again.');
            }
            
            generateTitlesBtn.disabled = false;
            generateTitlesBtn.innerHTML = 'Generate Informational Article Titles';
        }
        
        async function generateArticle() {
            const title = articleTitleInput.value.trim();
            if (!title) {
                alert('Please enter or select a title first');
                return;
            }
            
            generateArticleBtn.disabled = true;
            generateArticleBtn.innerHTML = '<span class="loading"></span> Generating...';
            
            try {
                const generateHeadings = generateHeadingsCheckbox.checked;
                const article = await callGenerateArticle(title, generateHeadings);
                
                // Update preview directly
                const htmlContent = generateHtmlContent(article);
                htmlPreview.srcdoc = htmlContent;
                
                articleOutputSection.classList.remove('hidden');
                anchorControls.classList.remove('hidden');
                
                // Show GitHub save button if connected
                if (githubAccessToken) {
                    saveToGithubBtn.classList.remove('hidden');
                    saveToGithubBtn2.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error generating article:', error);
                alert('Failed to generate article. Please try again.');
            }
            
            generateArticleBtn.disabled = false;
            generateArticleBtn.innerHTML = 'Generate Detailed Article';
        }
        
        function addAnchorToArticle() {
            const anchorText = anchorTextInput.value.trim();
            const targetUrl = targetUrlInput.value.trim();
            const position = anchorPositionSelect.value;
            
            if (!anchorText || !targetUrl) {
                alert('Please enter both anchor text and target URL');
                return;
            }
            
            let currentContent = htmlPreview.srcdoc;
            const anchorTag = `<a href="${targetUrl}" target="_blank">${anchorText}</a>`;
            
            // Create a temporary div to parse the HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = currentContent;
            
            // Find all paragraphs
            const paragraphs = tempDiv.querySelectorAll('p');
            let targetParagraph;
            
            switch (position) {
                case 'first':
                    targetParagraph = paragraphs[1]; // Skip the first paragraph which is usually the title
                    break;
                case 'second':
                    targetParagraph = paragraphs[2];
                    break;
                case 'third':
                    targetParagraph = paragraphs[3];
                    break;
                case 'last':
                    targetParagraph = paragraphs[paragraphs.length - 2]; // Skip the very last one
                    break;
                default:
                    targetParagraph = paragraphs[1];
            }
            
            if (targetParagraph) {
                // Insert anchor in the middle of the paragraph
                const sentences = targetParagraph.innerHTML.split('. ');
                if (sentences.length > 1) {
                    const insertPos = Math.floor(sentences.length / 2);
                    sentences.splice(insertPos, 0, anchorTag);
                    targetParagraph.innerHTML = sentences.join('. ');
                } else {
                    targetParagraph.innerHTML += ` ${anchorTag}`;
                }
            }
            
            // Update the preview
            htmlPreview.srcdoc = tempDiv.innerHTML;
            alert('Anchor link has been added to the article!');
        }
        
        function copyContent() {
            const range = document.createRange();
            range.selectNode(htmlPreview.contentDocument.body);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            alert('Content copied to clipboard!');
        }
        
        function downloadHtml() {
            const htmlContent = htmlPreview.srcdoc;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function generateHtmlContent(markdownText) {
            // Simple markdown to HTML conversion
            let html = markdownText
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            // Wrap in proper HTML structure with Poppins font
            return `<!DOCTYPE html>
<html>
<head>
    <title>${articleTitleInput.value || 'Generated Article'}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: white;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            font-weight: 600;
        }
        h2 {
            color: #3498db;
            margin-top: 30px;
            font-weight: 600;
        }
        a {
            color: #e74c3c;
            text-decoration: none;
            font-weight: bold;
        }
        a:hover {
            text-decoration: underline;
        }
        p {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <article>
        <p>${html}</p>
    </article>
</body>
</html>`;
        }
    </script>
</body>
</html>
